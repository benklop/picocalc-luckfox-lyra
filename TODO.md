# TODO List - PicoCalc Lyra Build System

This document tracks known issues, work-in-progress features, and planned improvements for the PicoCalc LuckFox Lyra build system.

## üö® Critical Issues (Not Working)

*No critical issues at this time - all major hardware functionality is working!*

## üîß Build System Improvements

### Kernel Configuration
- [ ] **Modular kernel config fragments** - Currently using single wildcard pattern `picocalc-rk3506-*.config` 
      which includes all drivers. Should implement support for multiple wildcard patterns or alternative 
      fragment selection mechanism to allow display-specific builds (DSI vs SPI) without unnecessary drivers.
      This would reduce memory usage by excluding unneeded display/touch drivers.
      - Related files: `RK_KERNEL_CFG_FRAGMENTS` in defconfig files
      - Current workaround: Renamed `picocalc-dsi-display.config` to `picocalc-rk3506-dsi-display.config`

### Releases
- [ ] **Working automated releases** - Releases are suppoosed to be cut when tags are updated, but the github 
      action for this is rough, largely autogenerated, and does not complete
- [ ] **automated PR tests** - a test workflow should run when a PR is submitted to ensure full functionality before merging

## üñ•Ô∏è System Integration

### Device Tree
- [ ] **WiFi power management** - May need additional power/reset GPIO config

### Boot Configuration
- [ ] **Document Windows flashing process** - I don't use windows so I can't really test this as easily

## üß™ Testing & Validation

### Hardware Testing
- [ ] **Power management** - Test suspend/resume functionality

### Build Testing
- [ ] **Cross-platform testing** - Test on different Linux distributions

## üîå Power Management Integration

### MCU Power Management
- [ ] **MCU firmware modifications** - Extend MCU firmware for power management
  - Add support for detecting short button press events (vs long press that 
    should still be handled by the MCU directly)
  - Implement power state commands (power off at least)
  - Create communication protocol for power management between MCU and Linux
  - **Priority**: High
- [ ] **Linux power management driver** - Create or extend driver for MCU power features
  - Option 1: Integrate into existing keyboard driver (same MCU device)
  - Option 2: Create separate power management driver
  - Handle button press events and translate to Linux power events
  - Implement power state control interface
  - **Priority**: High

## üìö Documentation

### User Documentation
- [ ] **Troubleshooting guide** - Expand troubleshooting sections
- [ ] **Hardware documentation** - Document GPIO usage, pinout
- [ ] **Setup and usage documentation** - Document initial setup, package selection, user creation, wifi setup, and so on

### Developer Documentation
- [ ] **Device tree reference** - Document custom DT bindings
- [ ] **Performance optimization** - Build optimization tips

## üîÆ Future Enhancements

### Additional Hardware Support
- [ ] **720x720 DSI display support (FL7707N)** - Add support for specific 720x720 DSI display from AliExpress
  - **Display Controller**: FL7707N with 720x720 IPS panel (display-only, no touch)
  - **Touch Support**: Not applicable - display module lacks touch hardware
  - **Timing Parameters**: VFP=20, VBP=20, VSA=4, HFP=106, HBP=120, HSA=60
  - **DSI Configuration**: 2-lane DSI interface with specific initialization sequence
  - Create device tree overlay for FL7707N display controller
  - Add display panel driver with proper initialization commands
  - Configure DSI timing parameters and power sequences
  - Test display output functionality
  - Provide build-time configuration option for display selection
  - Document installation and configuration process
  - **Note**: PicoCalc hardware would require modification to support touchscreen displays
- [ ] **Support LoRA radio** - use a bitbanged SPI interface on the pads below the lyra for this

### Software Features
- [ ] **Package manager** - Add package management for runtime installs

### Build System
- [ ] **Multi-target support** - Support for selecting different hardware variants
    - add/remove RTC from devicetree
    - add/remove Lyra SPI pins from devicetree
    - add/remove/select USB wifi driver
    - add/remove/select PWM audio driver
        - software PWM on one channel
        - hardware pwm on one channel
        - hardware pwm on two channels

## üöÄ Nice to Have

- [ ] **Community packages** - Package repository for community contributions

---

## ‚úÖ Completed Items

### WiFi System
- [x] ‚úÖ **RTL8188FU WiFi driver** - Driver builds but WiFi not functional

### Audio System
- [x] ‚úÖ **Stereo hardware PWM audio** - Audio output is now fully functional!
- [x] ‚úÖ **ALSA utilities** - Add alsa-utils package for audio debugging
- [x] ‚úÖ **Audio testing tools** - Add speaker-test, aplay utilities
- [x] ‚úÖ **Sound card detection** - Verify ALSA can see the PWM sound device

### USB Flashing
- [x] ‚úÖ **Automatic ADB reboot for flashing** - Use ADB to automatically reboot device into loader mode
- [x] ‚úÖ **Fix SD card ejection for `reboot loader`** - Device no longer hangs during reboot with external SD cards inserted

### Package System
- [x] ‚úÖ **RTL8188FU Driver Package creation** - BuildRoot package exists
- [x] ‚úÖ **Firmware installation** - Configured in package makefile
- [x] ‚úÖ **Driver debugging** - Investigate why WiFi doesn't work
- [x] ‚úÖ **Kernel config validation** - Ensure all required options enabled

### Device Tree & Hardware Support
- [x] ‚úÖ **Basic hardware support** - SD card, USB, I2C, SPI working
- [x] ‚úÖ **Display support** - ILI9488 LCD working
- [x] ‚úÖ **Keyboard support** - PicoCalc keyboard working  
- [x] ‚úÖ **RTC support** - DS3231 RTC working
- [x] ‚úÖ **Audio pinmux** - Verify PWM audio pins are correctly configured
- [x] ‚úÖ **Serial terminal on top USB port** - Enable serial console access via upper USB-C port
- [x] ‚úÖ **Terminal font size optimization** - Adjust console font for 320x320 display
- [x] ‚úÖ ~~**Separate /home partition** - Split /home into dedicated partition to preserve user data~~
      (resolved with overlay partition from nekocharm upstream, further enhanced here)

### Testing & Validation
- [x] ‚úÖ **WiFi scanning** - Test if RTL8188FU can at least scan networks
- [x] ‚úÖ **Clean build validation** - Test complete clean builds
- [x] ‚úÖ **Overlay testing** - Validate overlay overlay system

### Documentation
- [x] ‚úÖ **Flashing guide** - Comprehensive FLASHING.md
- [x] ‚úÖ **Build instructions** - Clear README.md
- [x] ‚úÖ **Package development** - Detailed ADDING_PACKAGES.md

---

## Notes

- **Priority Levels**: High (blocking basic functionality), Medium (usability), Low (convenience)
- **Status**: ‚úÖ Complete, üöß In Progress, ‚ùå Blocked, üìù Planning
- **Contributors**: Mark completed items with contributor name and date

## Contributing

When working on items from this list:

1. Move item to "In Progress" section with üöß marker
2. Create detailed issue/PR describing the work
3. Update this file when work is completed
4. Add any new discoveries or blockers to relevant sections

For questions about specific TODO items, create an issue referencing this file.
